<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0d6efd" />
  <title>Embebido – Conductores Urbanos</title>
  <style>
    :root{ --brand:#0d6efd; --ink:#0b1022; --card:#fff; --muted:#64748b; }
    *{ box-sizing:border-box }
    html,body{ height:100%; margin:0; }
    body{ font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:var(--ink); background:#f5f7fb; }
    header{
      position:sticky; top:0; z-index:5;
      display:flex; align-items:center; gap:12px;
      padding:10px max(12px, env(safe-area-inset-left)) 10px max(12px, env(safe-area-inset-right));
      background:#ffffffcc; backdrop-filter:blur(6px); border-bottom:1px solid #e5e7eb;
    }
    .brand{ font-weight:700; color:var(--ink) }
    .open{ margin-left:auto; appearance:none; border:1px solid #d0d7e2; background:#fff; color:var(--ink);
           padding:8px 12px; border-radius:10px; cursor:pointer }
    .wrap{
      height:calc(100dvh - 52px);
      padding:0 env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }
    iframe{
      width:100%; height:100%; border:0; border-radius:12px;
      background:linear-gradient(180deg,#eef2ff,#f8fafc);
      box-shadow:0 10px 30px rgba(16,24,40,.10);
    }
    /* Spinner mientras carga */
    .loading{
      position:fixed; inset:52px 0 0 0; display:grid; place-items:center; pointer-events:none;
      background:transparent; z-index:4;
    }
    .spinner{
      width:44px; height:44px; border-radius:999px; border:4px solid #e5e7eb;
      border-top-color:var(--brand); animation:spin 1s linear infinite;
    }
    @keyframes spin { to{ transform:rotate(360deg) } }
  </style>
</head>
<body>
  <header>
    <div class="brand">Conductores Urbanos</div>
    <button class="open" id="openNew">Abrir en pestaña nueva</button>
  </header>

  <div class="wrap">
    <iframe
      id="app"
      title="Web App Conductores"
      loading="eager"
      allow="camera; microphone; fullscreen; clipboard-read; clipboard-write"
      referrerpolicy="no-referrer"
      allowfullscreen
    ></iframe>
  </div>

  <div class="loading" id="loading"><div class="spinner" aria-label="Cargando"></div></div>

  <script>
    // === CONFIG ===
    const APP_URL = "https://script.google.com/macros/s/AKfycbxCFhsIXAxZa9ajK8HI-swQV7FZx5waEOHvkXAtKZv3rW4vdSN9aYO3rssNI9nRFxbl/exec";

    const iframe = document.getElementById('app');
    const loading = document.getElementById('loading');
    const openNew = document.getElementById('openNew');

    // Carga con parámetro opcional para que la app sepa que va embebida (si quieres usarlo)
    iframe.src = APP_URL + (APP_URL.includes("?") ? "&" : "?") + "embed=1";

    // Botón "abrir en nueva pestaña"
    openNew.addEventListener('click', () => window.open(APP_URL, "_blank", "noopener"));

    // Oculta spinner cuando la app termina de cargar
    iframe.addEventListener('load', () => {
      loading.style.display = 'none';
    });

    // Fallback: si en 10s no cargó, deja un enlace directo
    setTimeout(() => {
      if (loading.style.display !== 'none') {
        loading.innerHTML =
          '<div style="background:#fff;border:1px solid #e5e7eb;padding:12px 16px;border-radius:12px;box-shadow:0 10px 24px rgba(16,24,40,.12)">' +
          'No se pudo cargar dentro de la página. ' +
          '<a href="'+APP_URL+'" target="_blank" rel="noopener">Abrir la aplicación</a></div>';
      }
    }, 10000);

    // Ajuste si el móvil cambia orientación
    addEventListener('orientationchange', () => {
      // 100dvh ya cubre la mayoría de casos modernos; no hace falta más aquí.
    });
  </script>
</body>
</html>
